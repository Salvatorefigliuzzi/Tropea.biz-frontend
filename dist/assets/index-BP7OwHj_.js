import{c as Ke,d as be,e as We,u as Je,f as Ze,h as pe,j as e,N as je,C as F,L as O,i as ce,D as ie,B as y,O as Pe,a as t,k as D,A as V,F as i,S as H,l as ae,m as Qe,n as q,M as w,y as f,T as ve,P as R,o as Q,p as ze,q as Ge,s as Ae,b as Xe,t as es,v as U,w as ss,x as as,z as ts}from"./react-vendor-DZAgL3rM.js";import{K as Te}from"./vendor-CqMkY09-.js";import{F as ue,a as rs,b as Fe,c as Be,d as ns,e as Ue,f as qe,g as os,h as Le,i as is,j as de,k as Ne,l as me,m as we,n as Se,o as Ce,p as ls,q as cs,r as ds,s as ms,A as Re,t as Me}from"./icons-fa-BJENuLri.js";import"./ui-vendor-3-1qdDiz.js";import"./icons-lib-Ce2FCGZN.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))n(c);new MutationObserver(c=>{for(const r of c)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function l(c){const r={};return c.integrity&&(r.integrity=c.integrity),c.referrerPolicy&&(r.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?r.credentials="include":c.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(c){if(c.ep)return;c.ep=!0;const r=l(c);fetch(c.href,r)}})();const C=Te.create({baseURL:"/api",headers:{"Content-Type":"application/json"}});C.interceptors.request.use(s=>{const l=le.getState().auth.token;return l&&(s.headers.Authorization=`Bearer ${l}`),s},s=>Promise.reject(s));C.interceptors.response.use(s=>s,async s=>{const a=s.config;if(s.response?.status===401&&!a._retry){a._retry=!0;const l=le.getState(),n=l.auth.refreshToken;if(n)try{const c=await Te.post("/api/auth/refresh-token",{refreshToken:n}),{token:r,refreshToken:o}=c.data;return le.dispatch(ys({token:r,refreshToken:o,user:l.auth.user,permissions:l.auth.permissions,groups:l.auth.groups})),a.headers.Authorization=`Bearer ${r}`,C(a)}catch(c){return le.dispatch(De()),Promise.reject(c)}else le.dispatch(De())}return Promise.reject(s)});const us=async s=>(await C.post("/auth/login",s)).data,hs=async()=>(await C.get("/users/me")).data,ps=async s=>(await C.post("/auth/register",s)).data,xs=async s=>(await C.post("/auth/logout",{refreshToken:s})).data,js=async s=>(await C.post("/auth/forgot-password",{email:s})).data,gs=async s=>(await C.post("/auth/reset-password",s)).data,fs={user:null,token:localStorage.getItem("token"),refreshToken:localStorage.getItem("refreshToken"),permissions:[],groups:[],isAuthenticated:!!localStorage.getItem("token"),loading:!1,error:null},ge=be("auth/login",async(s,{rejectWithValue:a})=>{try{return await us(s)}catch(l){return a(l.response?.data?.message||"Login failed")}}),fe=be("auth/fetchProfile",async(s,{rejectWithValue:a})=>{try{return await hs()}catch(l){return a(l.response?.data?.message||"Failed to fetch profile")}}),he=be("auth/register",async(s,{rejectWithValue:a})=>{try{return await ps(s)}catch(l){return a(l.response?.data?.message||"Registration failed")}}),Ie=be("auth/logout",async(s,{getState:a})=>{const n=a().auth.refreshToken;try{n&&await xs(n)}catch(c){console.error("Logout API failed",c)}}),Oe=Ke({name:"auth",initialState:fs,reducers:{setCredentials:(s,a)=>{const{user:l,token:n,refreshToken:c,permissions:r,groups:o}=a.payload;s.user=l,s.token=n,s.refreshToken=c,s.permissions=r,s.groups=o,s.isAuthenticated=!0,localStorage.setItem("token",n),localStorage.setItem("refreshToken",c)},logout:s=>{s.user=null,s.token=null,s.refreshToken=null,s.permissions=[],s.groups=[],s.isAuthenticated=!1,s.loading=!1,s.error=null,localStorage.removeItem("token"),localStorage.removeItem("refreshToken")},clearError:s=>{s.error=null}},extraReducers:s=>{s.addCase(ge.pending,a=>{a.loading=!0,a.error=null}).addCase(ge.fulfilled,(a,l)=>{a.loading=!1;const{user:n,token:c,refreshToken:r,permissions:o,groups:m}=l.payload;a.user=n,a.token=c,a.refreshToken=r,a.permissions=o,a.groups=m,a.isAuthenticated=!0,localStorage.setItem("token",c),localStorage.setItem("refreshToken",r)}).addCase(ge.rejected,(a,l)=>{a.loading=!1,a.error=l.payload}).addCase(fe.pending,a=>{a.loading=!0}).addCase(fe.fulfilled,(a,l)=>{a.loading=!1;const{user:n,permissions:c,groups:r}=l.payload;a.user=n,a.permissions=c,a.groups=r,a.isAuthenticated=!0}).addCase(fe.rejected,a=>{a.loading=!1,a.isAuthenticated=!1,a.user=null,a.token=null,a.refreshToken=null,localStorage.removeItem("token"),localStorage.removeItem("refreshToken")}).addCase(he.pending,a=>{a.loading=!0,a.error=null}).addCase(he.fulfilled,a=>{a.loading=!1}).addCase(he.rejected,(a,l)=>{a.loading=!1,a.error=l.payload}).addCase(Ie.fulfilled,a=>{a.user=null,a.token=null,a.refreshToken=null,a.permissions=[],a.groups=[],a.isAuthenticated=!1,localStorage.removeItem("token"),localStorage.removeItem("refreshToken")})}}),{setCredentials:ys,logout:De,clearError:He}=Oe.actions,bs=Oe.reducer,le=We({reducer:{auth:bs}}),xe=Je,oe=Ze,vs=()=>{const{user:s,isAuthenticated:a}=oe(m=>m.auth),l=xe(),n=pe(),c=async()=>{await l(Ie()),n("/")},o=s&&(s.ruoli||[]).some(h=>h.nome==="USER")?"/":"/dashboard";return e.jsxs(e.Fragment,{children:[e.jsx(je,{expand:"lg",className:"navbar-custom sticky-top",children:e.jsxs(F,{children:[e.jsxs(je.Brand,{as:O,to:a?o:"/",children:[e.jsx(ue,{})," MyApp"]}),e.jsx(je.Toggle,{"aria-controls":"basic-navbar-nav"}),e.jsxs(je.Collapse,{id:"basic-navbar-nav",children:[e.jsx(ce,{className:"me-auto",children:e.jsxs(ce.Link,{as:O,to:a?o:"/",children:[e.jsx(rs,{className:"me-1"})," ",a&&o!=="/"?"Dashboard":"Home"]})}),e.jsx(ce,{className:"align-items-center",children:a?e.jsxs(ie,{align:"end",children:[e.jsxs(ie.Toggle,{variant:"light",id:"dropdown-basic",className:"d-flex align-items-center gap-2 border-0 bg-transparent",children:[e.jsx(Fe,{size:24,className:"text-primary"}),e.jsx("span",{className:"fw-medium",children:s?.name})]}),e.jsxs(ie.Menu,{className:"shadow-sm border-0 mt-2",children:[e.jsx(ie.Item,{disabled:!0,className:"text-muted small",children:s?.email}),e.jsx(ie.Divider,{}),e.jsxs(ie.Item,{onClick:c,className:"text-danger",children:[e.jsx(Be,{className:"me-2"})," Logout"]})]})]}):e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(y,{as:O,to:"/login",variant:"outline-primary",className:"px-4",children:"Login"}),e.jsx(y,{as:O,to:"/register",variant:"primary",className:"px-4",children:"Register"})]})})]})]})}),e.jsx(F,{className:"py-4",children:e.jsx(Pe,{})})]})},Ns=()=>{const[s,a]=t.useState(""),[l,n]=t.useState(""),c=xe(),r=pe(),{loading:o,error:m,isAuthenticated:u,user:h}=oe(p=>p.auth);t.useEffect(()=>{if(u&&h){console.log(h);const S=(h.ruoli||[]).some(k=>k.nome==="USER");r(S?"/":"/dashboard")}return()=>{c(He())}},[u,h,r,c]);const x=p=>{p.preventDefault(),c(ge({email:s,password:l}))};return e.jsx(F,{children:e.jsx("div",{className:"auth-wrapper animate-fade-in",children:e.jsx(D,{xs:12,md:6,lg:4,children:e.jsxs("div",{className:"auth-card",children:[e.jsxs("h2",{className:"auth-title",children:[e.jsx(ns,{className:"me-2"}),"Welcome Back"]}),e.jsx("p",{className:"text-center text-muted mb-4",children:"Please login to continue"}),m&&e.jsx(V,{variant:"danger",children:m}),e.jsxs(i,{onSubmit:x,children:[e.jsxs(i.Group,{className:"mb-3",controlId:"formBasicEmail",children:[e.jsx(i.Label,{children:"Email address"}),e.jsxs("div",{className:"input-group",children:[e.jsx("span",{className:"input-group-text bg-light border-end-0",children:e.jsx(Ue,{className:"text-muted"})}),e.jsx(i.Control,{type:"email",placeholder:"Enter your email",value:s,onChange:p=>a(p.target.value),required:!0,className:"border-start-0 ps-2"})]})]}),e.jsxs(i.Group,{className:"mb-4",controlId:"formBasicPassword",children:[e.jsx(i.Label,{children:"Password"}),e.jsxs("div",{className:"input-group",children:[e.jsx("span",{className:"input-group-text bg-light border-end-0",children:e.jsx(qe,{className:"text-muted"})}),e.jsx(i.Control,{type:"password",placeholder:"Enter your password",value:l,onChange:p=>n(p.target.value),required:!0,className:"border-start-0 ps-2"})]})]}),e.jsx(y,{variant:"primary",type:"submit",className:"w-100 mb-3",disabled:o,children:o?e.jsx(H,{animation:"border",size:"sm"}):"Login"})]}),e.jsxs("div",{className:"text-center mt-3",children:[e.jsx("p",{className:"mb-2",children:e.jsx(O,{to:"/forgot-password",children:"Forgot Password?"})}),e.jsxs("p",{className:"mb-0 text-muted",children:["Don't have an account? ",e.jsx(O,{to:"/register",className:"fw-bold",children:"Sign up"})]})]})]})})})})},ye=s=>{const l=/[A-Z]/.test(s),n=/[0-9]/.test(s),c=/[!@#$%^&*(),.?":{}|<>]/.test(s),r=[];return s.length<10&&r.push("Almeno 10 caratteri"),l||r.push("Almeno una lettera maiuscola"),n||r.push("Almeno un numero"),c||r.push("Almeno un carattere speciale"),{isValid:r.length===0,errors:r}},ws=()=>{const[s,a]=t.useState({name:"",surname:"",email:"",password:"",confirmPassword:"",privacyAccepted:!1,policyAccepted:!1}),[l,n]=t.useState(""),[c,r]=t.useState(""),o=xe(),m=pe(),{loading:u,error:h,isAuthenticated:x}=oe(k=>k.auth);t.useEffect(()=>(x&&m("/"),()=>{o(He())}),[x,m,o]);const p=k=>{const{name:I,value:j,type:E,checked:b}=k.target;a(P=>({...P,[I]:E==="checkbox"?b:j}))},S=async k=>{if(k.preventDefault(),n(""),r(""),s.password!==s.confirmPassword){n("Passwords do not match");return}const I=ye(s.password);if(!I.isValid){n(I.errors.join(". "));return}if(!s.privacyAccepted||!s.policyAccepted){n("You must accept Privacy Policy and Terms of Service");return}const j=await o(he({name:s.name,surname:s.surname,email:s.email,password:s.password,privacyAccepted:s.privacyAccepted,policyAccepted:s.policyAccepted}));he.fulfilled.match(j)&&(r("Registration successful! Please check your email to confirm your account."),setTimeout(()=>{m("/login")},3e3))};return e.jsx(F,{children:e.jsx("div",{className:"auth-wrapper animate-fade-in",children:e.jsx(D,{xs:12,md:8,lg:6,children:e.jsxs("div",{className:"auth-card",children:[e.jsxs("h2",{className:"auth-title",children:[e.jsx(os,{className:"me-2"}),"Create Account"]}),e.jsx("p",{className:"text-center text-muted mb-4",children:"Join us today! It takes only few steps."}),h&&e.jsx(V,{variant:"danger",children:h}),l&&e.jsx(V,{variant:"danger",children:l}),c&&e.jsx(V,{variant:"success",children:c}),e.jsxs(i,{onSubmit:S,children:[e.jsxs(ae,{children:[e.jsx(D,{md:6,children:e.jsxs(i.Group,{className:"mb-3",controlId:"formName",children:[e.jsx(i.Label,{children:"Name"}),e.jsxs("div",{className:"input-group",children:[e.jsx("span",{className:"input-group-text bg-light border-end-0",children:e.jsx(Le,{className:"text-muted"})}),e.jsx(i.Control,{type:"text",placeholder:"Name",name:"name",value:s.name,onChange:p,required:!0,className:"border-start-0 ps-2"})]})]})}),e.jsx(D,{md:6,children:e.jsxs(i.Group,{className:"mb-3",controlId:"formSurname",children:[e.jsx(i.Label,{children:"Surname"}),e.jsxs("div",{className:"input-group",children:[e.jsx("span",{className:"input-group-text bg-light border-end-0",children:e.jsx(Le,{className:"text-muted"})}),e.jsx(i.Control,{type:"text",placeholder:"Surname",name:"surname",value:s.surname,onChange:p,className:"border-start-0 ps-2"})]})]})})]}),e.jsxs(i.Group,{className:"mb-3",controlId:"formBasicEmail",children:[e.jsx(i.Label,{children:"Email address"}),e.jsxs("div",{className:"input-group",children:[e.jsx("span",{className:"input-group-text bg-light border-end-0",children:e.jsx(Ue,{className:"text-muted"})}),e.jsx(i.Control,{type:"email",placeholder:"Enter email",name:"email",value:s.email,onChange:p,required:!0,className:"border-start-0 ps-2"})]})]}),e.jsxs(ae,{children:[e.jsx(D,{md:6,children:e.jsxs(i.Group,{className:"mb-3",controlId:"formBasicPassword",children:[e.jsx(i.Label,{children:"Password"}),e.jsxs("div",{className:"input-group",children:[e.jsx("span",{className:"input-group-text bg-light border-end-0",children:e.jsx(qe,{className:"text-muted"})}),e.jsx(i.Control,{type:"password",placeholder:"Password",name:"password",value:s.password,onChange:p,required:!0,minLength:6,className:"border-start-0 ps-2"})]})]})}),e.jsx(D,{md:6,children:e.jsxs(i.Group,{className:"mb-3",controlId:"formConfirmPassword",children:[e.jsx(i.Label,{children:"Confirm Password"}),e.jsxs("div",{className:"input-group",children:[e.jsx("span",{className:"input-group-text bg-light border-end-0",children:e.jsx(is,{className:"text-muted"})}),e.jsx(i.Control,{type:"password",placeholder:"Confirm Password",name:"confirmPassword",value:s.confirmPassword,onChange:p,required:!0,minLength:6,className:"border-start-0 ps-2"})]})]})})]}),e.jsxs("div",{className:"mb-4 bg-light p-3 rounded",children:[e.jsx(i.Group,{className:"mb-2",controlId:"formPrivacy",children:e.jsx(i.Check,{type:"checkbox",label:"I accept the Privacy Policy",name:"privacyAccepted",checked:s.privacyAccepted,onChange:p,required:!0})}),e.jsx(i.Group,{className:"mb-0",controlId:"formPolicy",children:e.jsx(i.Check,{type:"checkbox",label:"I accept the Terms of Service",name:"policyAccepted",checked:s.policyAccepted,onChange:p,required:!0})})]}),e.jsx(y,{variant:"primary",type:"submit",className:"w-100 mb-3",disabled:u,children:u?e.jsx(H,{animation:"border",size:"sm"}):"Create Account"})]}),e.jsx("div",{className:"text-center",children:e.jsxs("p",{className:"mb-0 text-muted",children:["Already have an account? ",e.jsx(O,{to:"/login",className:"fw-bold",children:"Login"})]})})]})})})})},Ss=()=>{const[s,a]=t.useState(""),[l,n]=t.useState(""),[c,r]=t.useState(""),[o,m]=t.useState(!1),u=async h=>{h.preventDefault(),m(!0),r(""),n("");try{await js(s),n("Password reset email sent. Please check your inbox.")}catch(x){r(x.response?.data?.message||"Failed to send reset email.")}finally{m(!1)}};return e.jsx(F,{className:"mt-5",children:e.jsx(ae,{className:"justify-content-md-center",children:e.jsxs(D,{xs:12,md:6,children:[e.jsx("h2",{className:"text-center mb-4",children:"Forgot Password"}),c&&e.jsx(V,{variant:"danger",children:c}),l&&e.jsx(V,{variant:"success",children:l}),e.jsxs(i,{onSubmit:u,children:[e.jsxs(i.Group,{className:"mb-3",controlId:"formBasicEmail",children:[e.jsx(i.Label,{children:"Email address"}),e.jsx(i.Control,{type:"email",placeholder:"Enter email",value:s,onChange:h=>a(h.target.value),required:!0})]}),e.jsx(y,{variant:"primary",type:"submit",className:"w-100",disabled:o,children:o?e.jsx(H,{animation:"border",size:"sm"}):"Send Reset Link"})]}),e.jsx("div",{className:"mt-3 text-center",children:e.jsx(O,{to:"/login",children:"Back to Login"})})]})})})},Cs=()=>{const[s,a]=t.useState(""),[l,n]=t.useState(""),[c,r]=t.useState(""),[o,m]=t.useState(""),[u,h]=t.useState(!1),[x]=Qe(),p=pe(),S=x.get("token"),k=async I=>{if(I.preventDefault(),h(!0),m(""),r(""),s!==l){m("Passwords do not match"),h(!1);return}const j=ye(s);if(!j.isValid){m(j.errors.join(". ")),h(!1);return}if(!S){m("Invalid or missing token"),h(!1);return}try{await gs({token:S,password:s}),r("Password reset successfully. Redirecting to login..."),setTimeout(()=>{p("/login")},3e3)}catch(E){m(E.response?.data?.message||"Failed to reset password.")}finally{h(!1)}};return S?e.jsx(F,{className:"mt-5",children:e.jsx(ae,{className:"justify-content-md-center",children:e.jsxs(D,{xs:12,md:6,children:[e.jsx("h2",{className:"text-center mb-4",children:"Reset Password"}),o&&e.jsx(V,{variant:"danger",children:o}),c&&e.jsx(V,{variant:"success",children:c}),e.jsxs(i,{onSubmit:k,children:[e.jsxs(i.Group,{className:"mb-3",controlId:"formBasicPassword",children:[e.jsx(i.Label,{children:"New Password"}),e.jsx(i.Control,{type:"password",placeholder:"New Password",value:s,onChange:I=>a(I.target.value),required:!0,minLength:6})]}),e.jsxs(i.Group,{className:"mb-3",controlId:"formConfirmPassword",children:[e.jsx(i.Label,{children:"Confirm New Password"}),e.jsx(i.Control,{type:"password",placeholder:"Confirm New Password",value:l,onChange:I=>n(I.target.value),required:!0,minLength:6})]}),e.jsx(y,{variant:"primary",type:"submit",className:"w-100",disabled:u,children:u?e.jsx(H,{animation:"border",size:"sm"}):"Reset Password"})]})]})})}):e.jsx(F,{className:"mt-5",children:e.jsx(V,{variant:"danger",children:"Missing reset token."})})},ks=()=>{const{user:s}=oe(a=>a.auth);return e.jsxs(F,{fluid:!0,className:"p-0",children:[e.jsx("div",{className:"mb-5",children:e.jsxs("h1",{className:"display-4 fw-bold text-primary mb-3",children:["Benvenuto, ",s?.name," ",s?.surname]})}),e.jsx(q,{className:"shadow-sm border-0",children:e.jsxs(q.Body,{className:"p-5",children:[e.jsx("h4",{className:"mb-4",children:"Panoramica Dashboard"}),e.jsx("p",{className:"lead text-muted",children:"Seleziona una voce dal menu a sinistra per accedere alle funzionalità del tuo gruppo."})]})})]})},Ee=async s=>(await C.get("/gruppi",{params:s})).data,$e=async s=>(await C.get(`/gruppi/${s}`)).data,As=async s=>(await C.post("/gruppi",s)).data,Ps=async(s,a)=>(await C.put(`/gruppi/${s}`,a)).data,Is=async s=>(await C.delete(`/gruppi/${s}`)).data,Es=({show:s,onHide:a,onSubmit:l,initialData:n,isEditing:c})=>{const[r,o]=t.useState(n),[m,u]=t.useState(!1);t.useEffect(()=>{s&&(o(n),u(!1))},[s,n]);const h=async x=>{x.preventDefault(),u(!0);try{await l(r)}catch{}finally{u(!1)}};return e.jsx(w,{show:s,onHide:a,children:e.jsxs(i,{onSubmit:h,children:[e.jsx(w.Header,{closeButton:!0,children:e.jsx(w.Title,{children:c?"Modifica Gruppo":"Nuovo Gruppo"})}),e.jsxs(w.Body,{children:[e.jsxs(i.Group,{className:"mb-3",children:[e.jsx(i.Label,{children:"Nome"}),e.jsx(i.Control,{type:"text",placeholder:"Es. system",value:r.nome,onChange:x=>o({...r,nome:x.target.value}),required:!0})]}),e.jsxs(i.Group,{className:"mb-3",children:[e.jsx(i.Label,{children:"Alias"}),e.jsx(i.Control,{type:"text",placeholder:"Es. Sistema",value:r.alias,onChange:x=>o({...r,alias:x.target.value}),required:!0})]}),e.jsxs(i.Group,{className:"mb-3",children:[e.jsx(i.Label,{children:"Ordine"}),e.jsx(i.Control,{type:"number",placeholder:"0",value:r.ordine||0,onChange:x=>o({...r,ordine:parseInt(x.target.value,10)||0})})]}),e.jsxs(i.Group,{className:"mb-3",children:[e.jsx(i.Label,{children:"Icona"}),e.jsx(i.Control,{type:"text",placeholder:"Es. fa-user",value:r.icona||"",onChange:x=>o({...r,icona:x.target.value})})]})]}),e.jsxs(w.Footer,{children:[e.jsx(y,{variant:"secondary",onClick:a,disabled:m,children:"Annulla"}),e.jsx(y,{variant:"primary",type:"submit",disabled:m,children:m?"Salvataggio...":"Salva"})]})]})})},ke=({show:s,onHide:a,onConfirm:l,title:n,message:c,confirmLabel:r="Conferma",cancelLabel:o="Annulla",variant:m="danger"})=>e.jsxs(w,{show:s,onHide:a,children:[e.jsx(w.Header,{closeButton:!0,children:e.jsx(w.Title,{children:n})}),e.jsx(w.Body,{children:c}),e.jsxs(w.Footer,{children:[e.jsx(y,{variant:"secondary",onClick:a,children:o}),e.jsx(y,{variant:m,onClick:l,children:r})]})]}),zs=()=>{const[s,a]=t.useState([]),[l,n]=t.useState(!1),[c,r]=t.useState(null),[o,m]=t.useState(1),[u,h]=t.useState(1),[x,p]=t.useState(0),[S]=t.useState(10),[k,I]=t.useState("id"),[j,E]=t.useState("ASC"),[b,P]=t.useState(!1),[B,G]=t.useState(null),[Y,T]=t.useState({nome:"",alias:"",ordine:0,icona:""}),[J,g]=t.useState(!1),[L,X]=t.useState(null),K=t.useCallback(async()=>{n(!0),r(null);try{const N=await Ee({page:o,pageSize:S,sortBy:k,sortOrder:j});a(N.pagination.data),h(N.pagination.totalPages),p(N.pagination.totalItems)}catch(N){r(N.response?.data?.message||"Errore nel caricamento dei gruppi"),f.error("Errore nel caricamento dei gruppi")}finally{n(!1)}},[o,S,k,j]);t.useEffect(()=>{K()},[K]);const W=N=>{k===N?E(j==="ASC"?"DESC":"ASC"):(I(N),E("ASC"))},Z=()=>{G(null),T({nome:"",alias:"",ordine:0,icona:""}),P(!0)},ee=async N=>{try{const{gruppo:z}=await $e(N);G(z.id),T({nome:z.nome,alias:z.alias,ordine:z.ordine||0,icona:z.icona||""}),P(!0)}catch(z){f.error(z.response?.data?.message||"Impossibile recuperare i dati del gruppo")}},$=N=>{X(N),g(!0)},_=()=>{P(!1),G(null),T({nome:"",alias:"",ordine:0,icona:""})},re=async N=>{try{B?(await Ps(B,N),f.success("Gruppo aggiornato con successo")):(await As(N),f.success("Gruppo creato con successo")),_(),K()}catch(z){throw f.error(z.response?.data?.message||"Operazione fallita"),z}},te=async()=>{if(L)try{await Is(L),f.success("Gruppo eliminato con successo"),g(!1),K()}catch(N){f.error(N.response?.data?.message||"Eliminazione fallita")}},se=N=>k!==N?e.jsx(we,{className:"text-muted ms-1",size:12}):j==="ASC"?e.jsx(Se,{className:"ms-1"}):e.jsx(Ce,{className:"ms-1"});return e.jsxs(F,{fluid:!0,className:"p-4",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsx("h2",{className:"mb-0",children:"Gestione Gruppi"}),e.jsxs(y,{variant:"primary",onClick:Z,children:[e.jsx(de,{className:"me-2"})," Nuovo Gruppo"]})]}),c&&e.jsx(V,{variant:"danger",children:c}),e.jsx("div",{className:"bg-white rounded shadow-sm p-3",children:l?e.jsx("div",{className:"text-center p-5",children:e.jsx(H,{animation:"border",variant:"primary"})}):e.jsxs(e.Fragment,{children:[e.jsxs(ve,{hover:!0,responsive:!0,className:"mb-0",children:[e.jsx("thead",{className:"bg-light",children:e.jsxs("tr",{children:[e.jsxs("th",{style:{cursor:"pointer",width:"80px"},onClick:()=>W("id"),children:["ID ",se("id")]}),e.jsxs("th",{style:{cursor:"pointer"},onClick:()=>W("nome"),children:["Nome ",se("nome")]}),e.jsxs("th",{style:{cursor:"pointer"},onClick:()=>W("alias"),children:["Alias ",se("alias")]}),e.jsx("th",{className:"text-end",children:"Azioni"})]})}),e.jsx("tbody",{children:s.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"text-center py-4 text-muted",children:"Nessun gruppo trovato"})}):s.map(N=>e.jsxs("tr",{children:[e.jsx("td",{children:N.id}),e.jsx("td",{children:N.nome}),e.jsx("td",{children:N.alias}),e.jsxs("td",{className:"text-end",children:[e.jsx(y,{variant:"outline-primary",size:"sm",className:"me-2",onClick:()=>ee(N.id),children:e.jsx(Ne,{})}),e.jsx(y,{variant:"outline-danger",size:"sm",onClick:()=>$(N.id),children:e.jsx(me,{})})]})]},N.id))})]}),u>1&&e.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-4",children:[e.jsxs("div",{className:"text-muted small",children:["Visualizzati ",s.length," di ",x," risultati"]}),e.jsxs(R,{className:"mb-0",children:[e.jsx(R.First,{onClick:()=>m(1),disabled:o===1}),e.jsx(R.Prev,{onClick:()=>m(N=>Math.max(1,N-1)),disabled:o===1}),[...Array(u)].map((N,z)=>e.jsx(R.Item,{active:z+1===o,onClick:()=>m(z+1),children:z+1},z+1)),e.jsx(R.Next,{onClick:()=>m(N=>Math.min(u,N+1)),disabled:o===u}),e.jsx(R.Last,{onClick:()=>m(u),disabled:o===u})]})]})]})}),e.jsx(Es,{show:b,onHide:_,onSubmit:re,initialData:Y,isEditing:!!B}),e.jsx(ke,{show:J,onHide:()=>g(!1),onConfirm:te,title:"Conferma eliminazione",message:"Sei sicuro di voler eliminare questo gruppo? L'operazione non è reversibile.",confirmLabel:"Elimina",variant:"danger"})]})},Ls=async s=>(await C.get("/users",{params:s})).data,Ve=async s=>(await C.get(`/users/${s}`)).data,Rs=async s=>(await C.post("/users",s)).data,Ms=async(s,a)=>(await C.put(`/users/${s}`,a)).data,Ds=async s=>(await C.delete(`/users/${s}`)).data,_e=async s=>(await C.get("/ruoli",{params:s})).data,Ye=async s=>(await C.get(`/ruoli/${s}`)).data,Gs=async s=>(await C.post("/ruoli",s)).data,Ts=async(s,a)=>(await C.put(`/ruoli/${s}`,a)).data,Fs=async s=>(await C.delete(`/ruoli/${s}`)).data,Bs=async(s,a)=>(await C.post(`/ruoli/${s}/assegna`,{ruoloId:a})).data,Us=async(s,a)=>(await C.post(`/ruoli/${s}/disassegna`,{ruoloId:a})).data,qs=({show:s,onClose:a,userId:l})=>{const[n,c]=t.useState(null),[r,o]=t.useState([]),[m,u]=t.useState(!1),[h,x]=t.useState(!1);t.useEffect(()=>{s&&l&&(p(l),S())},[s,l]);const p=async b=>{u(!0);try{const{user:P}=await Ve(b);c(P)}catch(P){console.error(P),f.error("Errore nel caricamento dell'utente")}finally{u(!1)}},S=async()=>{x(!0);try{const b=await _e();o(b.pagination.data)}catch(b){console.error(b),f.error("Errore nel caricamento dei ruoli")}finally{x(!1)}},k=async b=>{if(n)try{await Bs(n.id,b.id),f.success("Ruolo assegnato"),p(n.id)}catch(P){f.error(P.response?.data?.message||"Errore assegnazione")}},I=async b=>{if(n)try{await Us(n.id,b.id),f.success("Ruolo rimosso"),p(n.id)}catch(P){f.error(P.response?.data?.message||"Errore rimozione")}},j=b=>n?.ruoli?.some(P=>P.id===b),E=r.filter(b=>!j(b.id));return e.jsxs(w,{show:s,onHide:a,size:"lg",centered:!0,children:[e.jsx(w.Header,{closeButton:!0,children:e.jsxs(w.Title,{children:["Gestione Ruoli - ",n?.name," ",n?.surname]})}),e.jsx(w.Body,{style:{minHeight:"400px"},children:e.jsxs(ae,{className:"h-100",children:[e.jsxs(D,{md:6,className:"border-end",children:[e.jsx("h6",{className:"text-center mb-3",children:"Ruoli Assegnati"}),m?e.jsx("div",{className:"text-center",children:e.jsx(H,{animation:"border",size:"sm"})}):e.jsxs(Q,{variant:"flush",style:{maxHeight:"350px",overflowY:"auto"},children:[n?.ruoli?.map(b=>e.jsxs(Q.Item,{className:"d-flex justify-content-between align-items-center",children:[e.jsx("div",{children:e.jsx("div",{className:"fw-bold",children:b.nome})}),e.jsx(y,{variant:"outline-danger",size:"sm",onClick:()=>I(b),children:e.jsx(me,{})})]},b.id)),(!n?.ruoli||n.ruoli.length===0)&&e.jsx("div",{className:"text-center text-muted mt-3",children:"Nessun ruolo assegnato"})]})]}),e.jsxs(D,{md:6,children:[e.jsx("h6",{className:"text-center mb-3",children:"Ruoli Disponibili"}),h?e.jsx("div",{className:"text-center",children:e.jsx(H,{animation:"border",size:"sm"})}):e.jsxs(Q,{variant:"flush",style:{maxHeight:"350px",overflowY:"auto"},children:[E.map(b=>e.jsxs(Q.Item,{className:"d-flex justify-content-between align-items-center",children:[e.jsx("div",{children:e.jsx("div",{className:"fw-bold",children:b.nome})}),e.jsx(y,{variant:"outline-success",size:"sm",onClick:()=>k(b),children:e.jsx(de,{})})]},b.id)),E.length===0&&e.jsx("div",{className:"text-center text-muted mt-3",children:"Nessun ruolo disponibile"})]})]})]})}),e.jsx(w.Footer,{children:e.jsx(y,{variant:"secondary",onClick:a,children:"Chiudi"})})]})},Os=({show:s,onHide:a,onSubmit:l,initialData:n,isEditing:c})=>{const[r,o]=t.useState(n),[m,u]=t.useState(""),[h,x]=t.useState([]),[p,S]=t.useState(!1);t.useEffect(()=>{s&&(o(n),u(""),x([]),S(!1))},[s,n]);const k=j=>{if(o({...r,password:j}),j){const E=ye(j);x(E.errors)}else x([])},I=async j=>{if(j.preventDefault(),r.password){if(!ye(r.password).isValid){f.error("La password non soddisfa i requisiti di sicurezza");return}if(r.password!==m){f.error("Le password non coincidono");return}}else if(!c){f.error("La password è obbligatoria");return}S(!0);try{await l(r)}catch{}finally{S(!1)}};return e.jsx(w,{show:s,onHide:a,children:e.jsxs(i,{onSubmit:I,children:[e.jsx(w.Header,{closeButton:!0,children:e.jsx(w.Title,{children:c?"Modifica Utente":"Nuovo Utente"})}),e.jsxs(w.Body,{children:[e.jsxs(i.Group,{className:"mb-3",children:[e.jsx(i.Label,{children:"Nome"}),e.jsx(i.Control,{type:"text",placeholder:"Es. Mario",value:r.name,onChange:j=>o({...r,name:j.target.value}),required:!0})]}),e.jsxs(i.Group,{className:"mb-3",children:[e.jsx(i.Label,{children:"Cognome"}),e.jsx(i.Control,{type:"text",placeholder:"Es. Rossi",value:r.surname||"",onChange:j=>o({...r,surname:j.target.value})})]}),e.jsxs(i.Group,{className:"mb-3",children:[e.jsx(i.Label,{children:"Email"}),e.jsx(i.Control,{type:"email",placeholder:"Es. mario.rossi@example.com",value:r.email,onChange:j=>o({...r,email:j.target.value}),required:!0,disabled:c}),c&&e.jsx(i.Text,{className:"text-muted",children:"L'email non può essere modificata."})]}),e.jsxs(i.Group,{className:"mb-3",children:[e.jsx(i.Label,{children:"Password"}),e.jsx(i.Control,{type:"password",placeholder:c?"Lascia vuoto per mantenere la password attuale":"Inserisci una password",value:r.password||"",onChange:j=>k(j.target.value),required:!c,isInvalid:h.length>0}),e.jsx(i.Control.Feedback,{type:"invalid",children:e.jsx("ul",{className:"mb-0 ps-3",children:h.map((j,E)=>e.jsx("li",{children:j},E))})})]}),(!c||r.password)&&e.jsxs(i.Group,{className:"mb-3",children:[e.jsx(i.Label,{children:"Conferma Password"}),e.jsx(i.Control,{type:"password",placeholder:"Ripeti la password",value:m,onChange:j=>u(j.target.value),required:!c||!!r.password,isInvalid:r.password!==m&&m!==""}),e.jsx(i.Control.Feedback,{type:"invalid",children:"Le password non coincidono"})]}),e.jsx(i.Group,{className:"mb-3",controlId:"formPrivacy",children:e.jsx(i.Check,{type:"checkbox",label:"Privacy Accepted",checked:r.privacyAccepted,onChange:j=>o({...r,privacyAccepted:j.target.checked}),required:!0})}),e.jsx(i.Group,{className:"mb-3",controlId:"formPolicy",children:e.jsx(i.Check,{type:"checkbox",label:"Policy Accepted",checked:r.policyAccepted,onChange:j=>o({...r,policyAccepted:j.target.checked}),required:!0})})]}),e.jsxs(w.Footer,{children:[e.jsx(y,{variant:"secondary",onClick:a,disabled:p,children:"Annulla"}),e.jsx(y,{variant:"primary",type:"submit",disabled:p,children:p?"Salvataggio...":"Salva"})]})]})})},Hs=()=>{const[s,a]=t.useState([]),[l,n]=t.useState(!1),[c,r]=t.useState(null),[o,m]=t.useState(1),[u,h]=t.useState(1),[x,p]=t.useState(0),[S]=t.useState(10),[k,I]=t.useState("id"),[j,E]=t.useState("ASC"),[b,P]=t.useState(!1),[B,G]=t.useState(null),[Y,T]=t.useState({email:"",password:"",name:"",surname:"",privacyAccepted:!0,policyAccepted:!0}),[J,g]=t.useState(!1),[L,X]=t.useState(null),[K,W]=t.useState(!1),[Z,ee]=t.useState(null),$=t.useCallback(async()=>{n(!0),r(null);try{const d=await Ls({page:o,pageSize:S,sortBy:k,sortOrder:j});a(d.pagination.data),h(d.pagination.totalPages),p(d.pagination.totalItems)}catch(d){r(d.response?.data?.message||"Errore nel caricamento degli utenti"),f.error("Errore nel caricamento degli utenti")}finally{n(!1)}},[o,S,k,j]);t.useEffect(()=>{$()},[$]);const _=d=>{k===d?E(j==="ASC"?"DESC":"ASC"):(I(d),E("ASC"))},re=()=>{G(null),T({email:"",password:"",name:"",surname:"",privacyAccepted:!0,policyAccepted:!0}),P(!0)},te=async d=>{try{const{user:A}=await Ve(d);G(A.id),T({email:A.email,password:"",name:A.name,surname:A.surname||"",privacyAccepted:!0,policyAccepted:!0}),P(!0)}catch(A){f.error(A.response?.data?.message||"Impossibile recuperare i dati dell'utente")}},se=d=>{X(d),g(!0)},N=d=>{ee(d),W(!0)},z=()=>{P(!1),G(null),T({email:"",password:"",name:"",surname:"",privacyAccepted:!0,policyAccepted:!0})},v=async d=>{try{if(B){const A={name:d.name,surname:d.surname,privacyAccepted:d.privacyAccepted,policyAccepted:d.policyAccepted};d.password&&(A.password=d.password),await Ms(B,A),f.success("Utente aggiornato con successo")}else await Rs(d),f.success("Utente creato con successo");z(),$()}catch(A){throw f.error(A.response?.data?.message||"Operazione fallita"),A}},M=async()=>{if(L)try{await Ds(L),f.success("Utente eliminato con successo"),g(!1),$()}catch(d){f.error(d.response?.data?.message||"Eliminazione fallita")}},ne=d=>k!==d?e.jsx(we,{className:"text-muted ms-1",size:12}):j==="ASC"?e.jsx(Se,{className:"ms-1"}):e.jsx(Ce,{className:"ms-1"});return e.jsxs(F,{fluid:!0,className:"p-4",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsx("h2",{className:"mb-0",children:"Gestione Utenti"}),e.jsxs(y,{variant:"primary",onClick:re,children:[e.jsx(de,{className:"me-2"})," Nuovo Utente"]})]}),c&&e.jsx(V,{variant:"danger",children:c}),e.jsx("div",{className:"bg-white rounded shadow-sm p-3",children:l?e.jsx("div",{className:"text-center p-5",children:e.jsx(H,{animation:"border",variant:"primary"})}):e.jsxs(e.Fragment,{children:[e.jsxs(ve,{hover:!0,responsive:!0,className:"mb-0",children:[e.jsx("thead",{className:"bg-light",children:e.jsxs("tr",{children:[e.jsxs("th",{style:{cursor:"pointer",width:"80px"},onClick:()=>_("id"),children:["ID ",ne("id")]}),e.jsxs("th",{style:{cursor:"pointer"},onClick:()=>_("name"),children:["Nome ",ne("name")]}),e.jsxs("th",{style:{cursor:"pointer"},onClick:()=>_("surname"),children:["Cognome ",ne("surname")]}),e.jsxs("th",{style:{cursor:"pointer"},onClick:()=>_("email"),children:["Email ",ne("email")]}),e.jsx("th",{children:"Stato"}),e.jsx("th",{className:"text-end",children:"Azioni"})]})}),e.jsx("tbody",{children:s.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center py-4 text-muted",children:"Nessun utente trovato"})}):s.map(d=>e.jsxs("tr",{children:[e.jsx("td",{children:d.id}),e.jsx("td",{children:d.name}),e.jsx("td",{children:d.surname}),e.jsx("td",{children:d.email}),e.jsx("td",{children:d.isVerified?e.jsx(ze,{bg:"success",children:"Verificato"}):e.jsx(ze,{bg:"warning",text:"dark",children:"Non Verificato"})}),e.jsxs("td",{className:"text-end",children:[e.jsx(y,{variant:"outline-info",size:"sm",className:"me-2",title:"Gestisci Ruoli",onClick:()=>N(d.id),children:e.jsx(ls,{})}),e.jsx(y,{variant:"outline-primary",size:"sm",className:"me-2",onClick:()=>te(d.id),children:e.jsx(Ne,{})}),e.jsx(y,{variant:"outline-danger",size:"sm",onClick:()=>se(d.id),children:e.jsx(me,{})})]})]},d.id))})]}),u>1&&e.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-4",children:[e.jsxs("div",{className:"text-muted small",children:["Visualizzati ",s.length," di ",x," risultati"]}),e.jsxs(R,{className:"mb-0",children:[e.jsx(R.First,{onClick:()=>m(1),disabled:o===1}),e.jsx(R.Prev,{onClick:()=>m(d=>Math.max(1,d-1)),disabled:o===1}),[...Array(u)].map((d,A)=>e.jsx(R.Item,{active:A+1===o,onClick:()=>m(A+1),children:A+1},A+1)),e.jsx(R.Next,{onClick:()=>m(d=>Math.min(u,d+1)),disabled:o===u}),e.jsx(R.Last,{onClick:()=>m(u),disabled:o===u})]})]})]})}),e.jsx(Os,{show:b,onHide:z,onSubmit:v,initialData:Y,isEditing:!!B}),e.jsx(ke,{show:J,onHide:()=>g(!1),onConfirm:M,title:"Conferma eliminazione",message:"Sei sicuro di voler eliminare questo utente? L'operazione non è reversibile.",confirmLabel:"Elimina",variant:"danger"}),e.jsx(qs,{show:K,onClose:()=>W(!1),userId:Z})]})},$s=async s=>(await C.get("/permessi",{params:s})).data,Vs=async s=>(await C.get(`/permessi/${s}`)).data,_s=async s=>(await C.post("/permessi",s)).data,Ys=async(s,a)=>(await C.put(`/permessi/${s}`,a)).data,Ks=async s=>(await C.delete(`/permessi/${s}`)).data,Ws=async(s,a)=>(await C.post(`/permessi/${s}/assegna`,{permessoId:a})).data,Js=async(s,a)=>(await C.post(`/permessi/${s}/disassegna`,{permessoId:a})).data,Zs=({show:s,onHide:a,onSubmit:l,initialData:n,isEditing:c,gruppi:r})=>{const[o,m]=t.useState(n),[u,h]=t.useState(!1);t.useEffect(()=>{s&&(m(n),h(!1))},[s,n]);const x=async p=>{p.preventDefault(),h(!0);try{await l(o)}catch{}finally{h(!1)}};return e.jsx(w,{show:s,onHide:a,children:e.jsxs(i,{onSubmit:x,children:[e.jsx(w.Header,{closeButton:!0,children:e.jsx(w.Title,{children:c?"Modifica Permesso":"Nuovo Permesso"})}),e.jsxs(w.Body,{children:[e.jsxs(i.Group,{className:"mb-3",children:[e.jsx(i.Label,{children:"Nome"}),e.jsx(i.Control,{type:"text",placeholder:"Es. permessi.read",value:o.nome,onChange:p=>m({...o,nome:p.target.value}),required:!0})]}),e.jsxs(i.Group,{className:"mb-3",children:[e.jsx(i.Label,{children:"Alias"}),e.jsx(i.Control,{type:"text",placeholder:"Es. Lettura Permessi",value:o.alias,onChange:p=>m({...o,alias:p.target.value}),required:!0})]}),e.jsxs(i.Group,{className:"mb-3",children:[e.jsx(i.Label,{children:"Gruppo"}),e.jsxs(i.Select,{value:o.gruppoId||"",onChange:p=>{const S=p.target.value;m({...o,gruppoId:S?parseInt(S,10):null})},children:[e.jsx("option",{value:"",children:"Nessun gruppo"}),r.map(p=>e.jsx("option",{value:p.id,children:p.alias||p.nome},p.id))]})]})]}),e.jsxs(w.Footer,{children:[e.jsx(y,{variant:"secondary",onClick:a,disabled:u,children:"Annulla"}),e.jsx(y,{variant:"primary",type:"submit",disabled:u,children:u?"Salvataggio...":"Salva"})]})]})})},Qs=()=>{const[s,a]=t.useState([]),[l,n]=t.useState([]),[c,r]=t.useState(!1),[o,m]=t.useState(null),[u,h]=t.useState(1),[x,p]=t.useState(1),[S,k]=t.useState(0),[I]=t.useState(10),[j,E]=t.useState("id"),[b,P]=t.useState("ASC"),[B,G]=t.useState(!1),[Y,T]=t.useState(null),[J,g]=t.useState({nome:"",alias:"",gruppoId:null}),[L,X]=t.useState(!1),[K,W]=t.useState(null),Z=t.useCallback(async()=>{r(!0),m(null);try{const v=await $s({page:u,pageSize:I,sortBy:j,sortOrder:b});a(v.pagination.data),p(v.pagination.totalPages),k(v.pagination.totalItems)}catch(v){m(v.response?.data?.message||"Errore nel caricamento dei permessi"),f.error("Errore nel caricamento dei permessi")}finally{r(!1)}},[u,I,j,b]);t.useEffect(()=>{Z()},[Z]),t.useEffect(()=>{(async()=>{try{const M=await Ee();n(M.pagination.data)}catch(M){console.error("Errore nel caricamento dei gruppi",M)}})()},[]);const ee=v=>{j===v?P(b==="ASC"?"DESC":"ASC"):(E(v),P("ASC"))},$=()=>{T(null),g({nome:"",alias:"",gruppoId:null}),G(!0)},_=async v=>{try{const{permesso:M}=await Vs(v);T(M.id),g({nome:M.nome,alias:M.alias,gruppoId:M.gruppoId||null}),G(!0)}catch(M){f.error(M.response?.data?.message||"Impossibile recuperare i dati del permesso")}},re=v=>{W(v),X(!0)},te=()=>{G(!1),T(null),g({nome:"",alias:"",gruppoId:null})},se=async v=>{try{Y?(await Ys(Y,v),f.success("Permesso aggiornato con successo")):(await _s(v),f.success("Permesso creato con successo")),te(),Z()}catch(M){throw f.error(M.response?.data?.message||"Operazione fallita"),M}},N=async()=>{if(K)try{await Ks(K),f.success("Permesso eliminato con successo"),X(!1),Z()}catch(v){f.error(v.response?.data?.message||"Eliminazione fallita")}},z=v=>j!==v?e.jsx(we,{className:"text-muted ms-1",size:12}):b==="ASC"?e.jsx(Se,{className:"ms-1"}):e.jsx(Ce,{className:"ms-1"});return e.jsxs(F,{fluid:!0,className:"p-4",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsx("h2",{className:"mb-0",children:"Gestione Permessi"}),e.jsxs(y,{variant:"primary",onClick:$,children:[e.jsx(de,{className:"me-2"})," Nuovo Permesso"]})]}),o&&e.jsx(V,{variant:"danger",children:o}),e.jsx("div",{className:"bg-white rounded shadow-sm p-3",children:c?e.jsx("div",{className:"text-center p-5",children:e.jsx(H,{animation:"border",variant:"primary"})}):e.jsxs(e.Fragment,{children:[e.jsxs(ve,{hover:!0,responsive:!0,className:"mb-0",children:[e.jsx("thead",{className:"bg-light",children:e.jsxs("tr",{children:[e.jsxs("th",{style:{cursor:"pointer",width:"80px"},onClick:()=>ee("id"),children:["ID ",z("id")]}),e.jsxs("th",{style:{cursor:"pointer"},onClick:()=>ee("nome"),children:["Nome ",z("nome")]}),e.jsxs("th",{style:{cursor:"pointer"},onClick:()=>ee("alias"),children:["Alias ",z("alias")]}),e.jsx("th",{className:"text-end",children:"Azioni"})]})}),e.jsx("tbody",{children:s.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"text-center py-4 text-muted",children:"Nessun permesso trovato"})}):s.map(v=>e.jsxs("tr",{children:[e.jsx("td",{children:v.id}),e.jsx("td",{children:v.nome}),e.jsx("td",{children:v.alias}),e.jsx("td",{children:v.gruppo?.alias||v.gruppo?.nome||"-"}),e.jsxs("td",{className:"text-end",children:[e.jsx(y,{variant:"outline-primary",size:"sm",className:"me-2",onClick:()=>_(v.id),children:e.jsx(Ne,{})}),e.jsx(y,{variant:"outline-danger",size:"sm",onClick:()=>re(v.id),children:e.jsx(me,{})})]})]},v.id))})]}),x>1&&e.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-4",children:[e.jsxs("div",{className:"text-muted small",children:["Visualizzati ",s.length," di ",S," risultati"]}),e.jsxs(R,{className:"mb-0",children:[e.jsx(R.First,{onClick:()=>h(1),disabled:u===1}),e.jsx(R.Prev,{onClick:()=>h(v=>Math.max(1,v-1)),disabled:u===1}),[...Array(x)].map((v,M)=>e.jsx(R.Item,{active:M+1===u,onClick:()=>h(M+1),children:M+1},M+1)),e.jsx(R.Next,{onClick:()=>h(v=>Math.min(x,v+1)),disabled:u===x}),e.jsx(R.Last,{onClick:()=>h(x),disabled:u===x})]})]})]})}),e.jsx(Zs,{show:B,onHide:te,onSubmit:se,initialData:J,isEditing:!!Y,gruppi:l}),e.jsx(ke,{show:L,onHide:()=>X(!1),onConfirm:N,title:"Conferma eliminazione",message:"Sei sicuro di voler eliminare questo permesso? L'operazione non è reversibile.",confirmLabel:"Elimina",variant:"danger"})]})},Xs=({show:s,onClose:a,ruoloId:l})=>{const[n,c]=t.useState(null),[r,o]=t.useState([]),[m,u]=t.useState(null),[h,x]=t.useState([]),[p,S]=t.useState(!1),[k,I]=t.useState(!1),[j,E]=t.useState(!1);t.useEffect(()=>{s&&l&&(b(l),P(),u(null),x([]))},[s,l]),t.useEffect(()=>{m?B(m):x([])},[m]);const b=async g=>{S(!0);try{const{ruolo:L}=await Ye(g);c(L)}catch(L){console.error(L),f.error("Errore nel caricamento del ruolo")}finally{S(!1)}},P=async()=>{I(!0);try{const g=await Ee();o(g.pagination.data)}catch(g){console.error(g),f.error("Errore nel caricamento dei gruppi")}finally{I(!1)}},B=async g=>{E(!0);try{const{gruppo:L}=await $e(g);x(L.permessi||[])}catch(L){console.error(L),f.error("Errore nel caricamento dei permessi del gruppo")}finally{E(!1)}},G=async g=>{if(n)try{console.log("ruolo id ",n.id),console.log("permesso id ",g.id),await Ws(n.id,g.id),f.success("Permesso assegnato"),b(n.id)}catch(L){f.error(L.response?.data?.message||"Errore assegnazione")}},Y=async g=>{if(n)try{await Js(n.id,g.id),f.success("Permesso rimosso"),b(n.id)}catch(L){f.error(L.response?.data?.message||"Errore rimozione")}},T=g=>n?.permessi?.some(L=>L.id===g),J=h.filter(g=>!T(g.id));return e.jsxs(w,{show:s,onHide:a,size:"xl",centered:!0,children:[e.jsx(w.Header,{closeButton:!0,children:e.jsxs(w.Title,{children:["Gestione Permessi - ",n?.nome]})}),e.jsx(w.Body,{style:{minHeight:"500px"},children:e.jsxs(ae,{className:"h-100",children:[e.jsxs(D,{md:4,className:"border-end",children:[e.jsx("h6",{className:"text-center mb-3",children:"Permessi Assegnati"}),p?e.jsx("div",{className:"text-center",children:e.jsx(H,{animation:"border",size:"sm"})}):e.jsxs(Q,{variant:"flush",style:{maxHeight:"400px",overflowY:"auto"},children:[n?.permessi?.map(g=>e.jsxs(Q.Item,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"fw-bold",children:g.nome}),e.jsx("small",{className:"text-muted",children:g.alias})]}),e.jsx(y,{variant:"outline-danger",size:"sm",onClick:()=>Y(g),children:e.jsx(me,{})})]},g.id)),(!n?.permessi||n.permessi.length===0)&&e.jsx("div",{className:"text-center text-muted mt-3",children:"Nessun permesso assegnato"})]})]}),e.jsxs(D,{md:4,className:"border-end",children:[e.jsx("h6",{className:"text-center mb-3",children:"Gruppi"}),k?e.jsx("div",{className:"text-center",children:e.jsx(H,{animation:"border",size:"sm"})}):e.jsx(Q,{style:{maxHeight:"400px",overflowY:"auto"},children:r.map(g=>e.jsxs(Q.Item,{action:!0,active:m===g.id,onClick:()=>u(g.id),children:[e.jsx("div",{className:"fw-bold",children:g.nome}),e.jsx("small",{children:g.alias})]},g.id))})]}),e.jsxs(D,{md:4,children:[e.jsxs("h6",{className:"text-center mb-3",children:["Permessi Disponibili ",m?"(Gruppo)":""]}),m?j?e.jsx("div",{className:"text-center",children:e.jsx(H,{animation:"border",size:"sm"})}):e.jsxs(Q,{variant:"flush",style:{maxHeight:"400px",overflowY:"auto"},children:[J.map(g=>e.jsxs(Q.Item,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"fw-bold",children:g.nome}),e.jsx("small",{className:"text-muted",children:g.alias})]}),e.jsx(y,{variant:"outline-success",size:"sm",onClick:()=>G(g),children:e.jsx(de,{})})]},g.id)),J.length===0&&e.jsx("div",{className:"text-center text-muted mt-3",children:"Nessun permesso disponibile in questo gruppo"})]}):e.jsx("div",{className:"text-center text-muted mt-5",children:"Seleziona un gruppo per vedere i permessi"})]})]})}),e.jsx(w.Footer,{children:e.jsx(y,{variant:"secondary",onClick:a,children:"Chiudi"})})]})},ea=({show:s,onHide:a,onSubmit:l,initialData:n,isEditing:c})=>{const[r,o]=t.useState(n),[m,u]=t.useState(!1);t.useEffect(()=>{s&&(o(n),u(!1))},[s,n]);const h=async x=>{x.preventDefault(),u(!0);try{await l(r)}catch{}finally{u(!1)}};return e.jsx(w,{show:s,onHide:a,children:e.jsxs(i,{onSubmit:h,children:[e.jsx(w.Header,{closeButton:!0,children:e.jsx(w.Title,{children:c?"Modifica Ruolo":"Nuovo Ruolo"})}),e.jsx(w.Body,{children:e.jsxs(i.Group,{className:"mb-3",children:[e.jsx(i.Label,{children:"Nome"}),e.jsx(i.Control,{type:"text",placeholder:"Es. admin",value:r.nome,onChange:x=>o({...r,nome:x.target.value}),required:!0})]})}),e.jsxs(w.Footer,{children:[e.jsx(y,{variant:"secondary",onClick:a,disabled:m,children:"Annulla"}),e.jsx(y,{variant:"primary",type:"submit",disabled:m,children:m?"Salvataggio...":"Salva"})]})]})})},sa=()=>{const[s,a]=t.useState([]),[l,n]=t.useState(!1),[c,r]=t.useState(null),[o,m]=t.useState(1),[u,h]=t.useState(1),[x,p]=t.useState(0),[S]=t.useState(10),[k,I]=t.useState("id"),[j,E]=t.useState("ASC"),[b,P]=t.useState(!1),[B,G]=t.useState(null),[Y,T]=t.useState({nome:""}),[J,g]=t.useState(!1),[L,X]=t.useState(null),[K,W]=t.useState(!1),[Z,ee]=t.useState(null),$=t.useCallback(async()=>{n(!0),r(null);try{const d=await _e({page:o,pageSize:S,sortBy:k,sortOrder:j});a(d.pagination.data),h(d.pagination.totalPages),p(d.pagination.totalItems)}catch(d){r(d.response?.data?.message||"Errore nel caricamento dei ruoli"),f.error("Errore nel caricamento dei ruoli")}finally{n(!1)}},[o,S,k,j]);t.useEffect(()=>{$()},[$]);const _=d=>{k===d?E(j==="ASC"?"DESC":"ASC"):(I(d),E("ASC"))},re=()=>{G(null),T({nome:""}),P(!0)},te=async d=>{try{const{ruolo:A}=await Ye(d);G(A.id),T({nome:A.nome}),P(!0)}catch(A){f.error(A.response?.data?.message||"Impossibile recuperare i dati del ruolo")}},se=d=>{ee(d),W(!0)},N=d=>{X(d),g(!0)},z=()=>{P(!1),G(null),T({nome:""})},v=async d=>{try{B?(await Ts(B,d),f.success("Ruolo aggiornato con successo")):(await Gs(d),f.success("Ruolo creato con successo")),z(),$()}catch(A){throw f.error(A.response?.data?.message||"Operazione fallita"),A}},M=async()=>{if(L)try{await Fs(L),f.success("Ruolo eliminato con successo"),g(!1),$()}catch(d){f.error(d.response?.data?.message||"Eliminazione fallita")}},ne=d=>k!==d?e.jsx(we,{className:"text-muted ms-1",size:12}):j==="ASC"?e.jsx(Se,{className:"ms-1"}):e.jsx(Ce,{className:"ms-1"});return e.jsxs(F,{fluid:!0,className:"p-4",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsx("h2",{className:"mb-0",children:"Gestione Ruoli"}),e.jsxs(y,{variant:"primary",onClick:re,children:[e.jsx(de,{className:"me-2"})," Nuovo Ruolo"]})]}),c&&e.jsx(V,{variant:"danger",children:c}),e.jsx("div",{className:"bg-white rounded shadow-sm p-3",children:l?e.jsx("div",{className:"text-center p-5",children:e.jsx(H,{animation:"border",variant:"primary"})}):e.jsxs(e.Fragment,{children:[e.jsxs(ve,{hover:!0,responsive:!0,className:"mb-0",children:[e.jsx("thead",{className:"bg-light",children:e.jsxs("tr",{children:[e.jsxs("th",{style:{cursor:"pointer",width:"80px"},onClick:()=>_("id"),children:["ID ",ne("id")]}),e.jsxs("th",{style:{cursor:"pointer"},onClick:()=>_("nome"),children:["Nome ",ne("nome")]}),e.jsx("th",{className:"text-end",children:"Azioni"})]})}),e.jsx("tbody",{children:s.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"text-center py-4 text-muted",children:"Nessun ruolo trovato"})}):s.map(d=>e.jsxs("tr",{children:[e.jsx("td",{children:d.id}),e.jsx("td",{children:d.nome}),e.jsxs("td",{className:"text-end",children:[e.jsx(y,{variant:"outline-info",size:"sm",className:"me-2",onClick:()=>se(d.id),title:"Gestisci Permessi",children:e.jsx(cs,{})}),e.jsx(y,{variant:"outline-primary",size:"sm",className:"me-2",onClick:()=>te(d.id),children:e.jsx(Ne,{})}),e.jsx(y,{variant:"outline-danger",size:"sm",onClick:()=>N(d.id),children:e.jsx(me,{})})]})]},d.id))})]}),u>1&&e.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-4",children:[e.jsxs("div",{className:"text-muted small",children:["Visualizzati ",s.length," di ",x," risultati"]}),e.jsxs(R,{className:"mb-0",children:[e.jsx(R.First,{onClick:()=>m(1),disabled:o===1}),e.jsx(R.Prev,{onClick:()=>m(d=>Math.max(1,d-1)),disabled:o===1}),[...Array(u)].map((d,A)=>e.jsx(R.Item,{active:A+1===o,onClick:()=>m(A+1),children:A+1},A+1)),e.jsx(R.Next,{onClick:()=>m(d=>Math.min(u,d+1)),disabled:o===u}),e.jsx(R.Last,{onClick:()=>m(u),disabled:o===u})]})]})]})}),e.jsx(ea,{show:b,onHide:z,onSubmit:v,initialData:Y,isEditing:!!B}),e.jsx(ke,{show:J,onHide:()=>g(!1),onConfirm:M,title:"Conferma eliminazione",message:"Sei sicuro di voler eliminare questo ruolo? L'operazione non è reversibile.",confirmLabel:"Elimina",variant:"danger"}),e.jsx(Xs,{show:K,onClose:()=>W(!1),ruoloId:Z})]})},aa=()=>e.jsxs("div",{className:"landing-page",children:[e.jsx("div",{className:"bg-light py-5 mb-5 rounded-3",children:e.jsx(F,{children:e.jsxs(ae,{className:"align-items-center",children:[e.jsxs(D,{lg:6,className:"mb-4 mb-lg-0",children:[e.jsx("h1",{className:"display-4 fw-bold mb-3",children:"Benvenuto in MyApp"}),e.jsx("p",{className:"lead mb-4 text-muted",children:"La soluzione completa per gestire i tuoi progetti, team e permessi in modo semplice e sicuro. Inizia oggi stesso a trasformare il tuo modo di lavorare."}),e.jsxs("div",{className:"d-flex gap-3",children:[e.jsx(y,{as:O,to:"/register",variant:"primary",size:"lg",className:"px-4",children:"Inizia Gratis"}),e.jsx(y,{as:O,to:"/login",variant:"outline-secondary",size:"lg",className:"px-4",children:"Accedi"})]})]}),e.jsx(D,{lg:6,className:"text-center",children:e.jsx("img",{src:"https://placehold.co/600x400?text=Hero+Image",alt:"Hero Illustration",className:"img-fluid rounded shadow-sm"})})]})})}),e.jsxs(F,{className:"mb-5",children:[e.jsx(ae,{className:"text-center mb-5",children:e.jsxs(D,{children:[e.jsx("h2",{className:"fw-bold",children:"Perché sceglierci?"}),e.jsx("p",{className:"text-muted",children:"Tutto ciò di cui hai bisogno per scalare il tuo business."})]})}),e.jsxs(ae,{children:[e.jsx(D,{md:4,className:"mb-4",children:e.jsx(q,{className:"h-100 border-0 shadow-sm text-center p-4",children:e.jsxs(q.Body,{children:[e.jsx("div",{className:"mb-3 text-primary",children:e.jsx(ds,{size:50})}),e.jsx(q.Title,{as:"h4",children:"Sicurezza Avanzata"}),e.jsx(q.Text,{className:"text-muted",children:"Protezione dei dati di livello enterprise con autenticazione robusta e gestione granulare dei permessi."})]})})}),e.jsx(D,{md:4,className:"mb-4",children:e.jsx(q,{className:"h-100 border-0 shadow-sm text-center p-4",children:e.jsxs(q.Body,{children:[e.jsx("div",{className:"mb-3 text-primary",children:e.jsx(ue,{size:50})}),e.jsx(q.Title,{as:"h4",children:"Performance Top"}),e.jsx(q.Text,{className:"text-muted",children:"Un'interfaccia veloce e reattiva costruita con le ultime tecnologie per garantirti la massima efficienza."})]})})}),e.jsx(D,{md:4,className:"mb-4",children:e.jsx(q,{className:"h-100 border-0 shadow-sm text-center p-4",children:e.jsxs(q.Body,{children:[e.jsx("div",{className:"mb-3 text-primary",children:e.jsx(ms,{size:50})}),e.jsx(q.Title,{as:"h4",children:"Collaborazione Team"}),e.jsx(q.Text,{className:"text-muted",children:"Strumenti pensati per far lavorare insieme i tuoi team in armonia, ovunque si trovino."})]})})})]})]}),e.jsx("div",{className:"bg-primary text-white py-5 rounded-3 mb-5",children:e.jsxs(F,{className:"text-center",children:[e.jsx("h2",{className:"mb-4",children:"Pronto a partire?"}),e.jsx("p",{className:"lead mb-4",children:"Unisciti a migliaia di utenti soddisfatti che hanno già migliorato il loro workflow."}),e.jsx(O,{to:"/register",className:"btn btn-light btn-lg px-5 text-primary fw-bold",children:"Registrati Ora"})]})}),e.jsx("footer",{className:"text-center text-muted py-4 border-top",children:e.jsx(F,{children:e.jsx("p",{className:"mb-0",children:"© 2025 MyApp. Tutti i diritti riservati."})})})]}),ta=()=>{const{isAuthenticated:s,user:a,loading:l}=oe(c=>c.auth),n=Ge();return s?l&&!a?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"100vh"},children:e.jsx(H,{animation:"border",variant:"primary"})}):a&&(a.ruoli||[]).some(o=>o.nome==="USER")?e.jsx(Ae,{to:"/",replace:!0}):e.jsx(Pe,{}):e.jsx(Ae,{to:"/",state:{from:n},replace:!0})},ra=()=>{const{user:s,groups:a}=oe(h=>h.auth),l=xe(),n=pe(),c=Ge(),[r,o]=Xe.useState(!0),m=async()=>{await l(Ie()),n("/")},u=()=>{o(!r)};return e.jsxs("div",{className:"d-flex vh-100 overflow-hidden bg-light",children:[e.jsxs("div",{className:`bg-white border-end d-flex flex-column transition-all ${r?"sidebar-open":"sidebar-closed"}`,style:{width:r?"280px":"0",minWidth:r?"280px":"0",transition:"all 0.3s ease",overflow:"hidden"},children:[e.jsx("div",{className:"p-4 border-bottom d-flex align-items-center justify-content-between",children:e.jsxs(O,{to:"/dashboard",className:"text-decoration-none d-flex align-items-center gap-2 text-primary fw-bold fs-5",children:[e.jsx(ue,{})," MyApp"]})}),e.jsxs("div",{className:"flex-grow-1 overflow-auto p-3",children:[e.jsx("small",{className:"text-muted text-uppercase fw-bold px-3 mb-2 d-block",style:{fontSize:"0.75rem"},children:"Menu"}),e.jsxs(ce,{className:"flex-column gap-1",children:[e.jsxs(ce.Link,{as:O,to:"/dashboard",active:c.pathname==="/dashboard",className:`rounded px-3 py-2 d-flex align-items-center gap-2 ${c.pathname==="/dashboard"?"bg-primary text-white":"text-dark hover-bg-light"}`,children:[e.jsx(ue,{})," Dashboard"]}),a.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"my-2 border-top"}),e.jsx("small",{className:"text-muted text-uppercase fw-bold px-3 mb-2 d-block",style:{fontSize:"0.75rem"},children:"Moduli"}),[...a].sort((h,x)=>(h.ordine||0)-(x.ordine||0)).map(h=>{const x=`/dashboard/${h.nome}`,p=c.pathname===x,S=h.icona&&Re[h.icona]?Re[h.icona]:ue;return e.jsxs(ce.Link,{as:O,to:x,active:p,className:`rounded px-3 py-2 d-flex align-items-center gap-2 ${p?"bg-primary text-white":"text-dark hover-bg-light"}`,children:[e.jsx(S,{}),e.jsx("span",{children:h.alias||h.nome})]},h.id)})]})]})]}),e.jsx("div",{className:"p-3 border-top",children:e.jsxs("div",{className:"d-flex align-items-center gap-3 p-2 rounded bg-light",children:[e.jsx(Fe,{size:32,className:"text-secondary"}),e.jsxs("div",{className:"overflow-hidden",children:[e.jsx("div",{className:"fw-bold text-truncate",children:s?.name}),e.jsx("div",{className:"small text-muted text-truncate",children:s?.email})]})]})})]}),e.jsxs("div",{className:"flex-grow-1 d-flex flex-column h-100 overflow-hidden",children:[e.jsxs("div",{className:"bg-white border-bottom p-3 d-flex align-items-center justify-content-between",children:[e.jsx(y,{variant:"link",className:"text-dark p-0",onClick:u,children:r?e.jsx(Me,{size:20}):e.jsx(Me,{size:20})}),e.jsx("div",{className:"d-flex align-items-center gap-3",children:e.jsxs(y,{variant:"outline-danger",size:"sm",onClick:m,className:"d-flex align-items-center gap-2",children:[e.jsx(Be,{})," Logout"]})})]}),e.jsx("div",{className:"flex-grow-1 overflow-auto p-4",children:e.jsx(Pe,{})})]})]})},na=()=>e.jsxs(es,{children:[e.jsxs(U,{path:"/",element:e.jsx(vs,{}),children:[e.jsx(U,{index:!0,element:e.jsx(aa,{})}),e.jsx(U,{path:"login",element:e.jsx(Ns,{})}),e.jsx(U,{path:"register",element:e.jsx(ws,{})}),e.jsx(U,{path:"forgot-password",element:e.jsx(Ss,{})}),e.jsx(U,{path:"reset-password",element:e.jsx(Cs,{})})]}),e.jsx(U,{path:"/dashboard",element:e.jsx(ta,{}),children:e.jsxs(U,{element:e.jsx(ra,{}),children:[e.jsx(U,{index:!0,element:e.jsx(ks,{})}),e.jsx(U,{path:"Gruppi",element:e.jsx(zs,{})}),e.jsx(U,{path:"Users",element:e.jsx(Hs,{})}),e.jsx(U,{path:"Permessi",element:e.jsx(Qs,{})}),e.jsx(U,{path:"Ruoli",element:e.jsx(sa,{})})]})}),e.jsx(U,{path:"*",element:e.jsx(Ae,{to:"/",replace:!0})})]}),oa=()=>{const s=xe(),{token:a,user:l}=oe(n=>n.auth);return t.useEffect(()=>{a&&!l&&s(fe())},[s,a,l]),e.jsx(ss,{children:e.jsx(na,{})})};as.createRoot(document.getElementById("root")).render(e.jsx(t.StrictMode,{children:e.jsx(ts,{store:le,children:e.jsx(oa,{})})}));
